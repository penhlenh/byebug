---

name: windows

on: [push]

jobs:
  test:
    runs-on: windows-2019

    strategy:
      matrix:
        version: ["2.4.x", "2.5.x", "2.6.x", "head"]

    steps:
      - uses: actions/checkout@master

      - name: Setup released rubies
        uses: actions/setup-ruby@v1
        with:
          ruby-version: ${{ matrix.version }}
        if: matrix.version != 'head'

      - name: Setup ruby-head
        run: |
          $(new-object net.webclient).DownloadFile("https://github.com/oneclick/rubyinstaller2/releases/download/rubyinstaller-head/rubyinstaller-${{ matrix.version }}-x64.exe", "$pwd/ruby-setup.exe")
          cmd /c ruby-setup.exe /verysilent /dir=C:/Ruby${{ matrix.version }}-x64
        if: matrix.version == 'head'

      - name: Setup path for ruby-head
        run: set PATH=C:\Ruby${{ matrix.version }}-x64\bin;C:\Program Files\Git\cmd;C:/Windows/system32;C:\Program Files\Git\usr\bin
        shell: cmd
        if: matrix.version == 'head'

      - name: Run CI checks
        run: |
          ridk enable
          bin/setup.sh
          bin/rake compile test
        shell: bash
